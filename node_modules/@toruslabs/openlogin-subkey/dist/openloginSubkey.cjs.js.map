{"version":3,"file":"openloginSubkey.cjs.js","mappings":"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","sources":["webpack://@toruslabs/openlogin-subkey/webpack/bootstrap","webpack://@toruslabs/openlogin-subkey/webpack/runtime/compat get default export","webpack://@toruslabs/openlogin-subkey/webpack/runtime/define property getters","webpack://@toruslabs/openlogin-subkey/webpack/runtime/hasOwnProperty shorthand","webpack://@toruslabs/openlogin-subkey/webpack/runtime/make namespace object","webpack://@toruslabs/openlogin-subkey/external commonjs2 \"bn.js\"","webpack://@toruslabs/openlogin-subkey/external commonjs2 \"@toruslabs/ffjavascript\"","webpack://@toruslabs/openlogin-subkey/external commonjs2 \"@toruslabs/metadata-helpers\"","webpack://@toruslabs/openlogin-subkey/./src/mimcsponge.ts","webpack://@toruslabs/openlogin-subkey/./src/keyDerivation.ts","webpack://@toruslabs/openlogin-subkey/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bn.js\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/ffjavascript\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/metadata-helpers\");","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable camelcase */\nimport { Scalar, ZqField } from \"@toruslabs/ffjavascript\";\nimport { keccak256 } from \"@toruslabs/metadata-helpers\";\nimport BN from \"bn.js\";\n\nconst F = new ZqField(Scalar.fromString(\"21888242871839275222246405745257275088548364400416034343698204186575808495617\"));\n\nconst SEED = \"mimcsponge\";\nconst NROUNDS = 220;\n\nfunction keccak256Padded(str: string): string {\n  let finalInput: Buffer = Buffer.from(str, \"utf8\");\n  if (typeof str === \"string\" && str.slice(0, 2) === \"0x\" && str.length === 66) {\n    finalInput = Buffer.from(str.slice(2), \"hex\");\n  }\n  return `0x${keccak256(finalInput).toString(\"hex\").padStart(64, \"0\")}`;\n}\n\nexport function mimgGetIV(seed: string): bigint {\n  let _seed = seed;\n  if (typeof _seed === \"undefined\") _seed = SEED;\n  const c = keccak256Padded(`${_seed}_iv`);\n  const cn = Scalar.fromString(new BN(c, 16).toString());\n  const iv = cn.mod(F.p);\n  return iv;\n}\n\nexport function mimcGetConstants(seed?: string, nRounds?: number): bigint[] {\n  let _seed = seed;\n  let _nRounds = nRounds;\n  if (typeof _seed === \"undefined\") _seed = SEED;\n  if (typeof nRounds === \"undefined\") _nRounds = NROUNDS;\n  const cts = new Array(_nRounds);\n  let c = keccak256Padded(SEED);\n  for (let i = 1; i < _nRounds; i += 1) {\n    c = keccak256Padded(c);\n\n    const n1 = new BN(c.slice(2), 16).mod(new BN(F.p.toString()));\n    const c2 = n1.toString(16, 64);\n    cts[i] = F.e(new BN(c2, 16).toString());\n  }\n  cts[0] = F.e(0);\n  cts[cts.length - 1] = F.e(0);\n  return cts;\n}\n\nconst cts = mimcGetConstants(SEED, NROUNDS);\n\nexport function mimcHash(\n  _xL_in: any,\n  _xR_in: any,\n  _k: any\n): {\n  xL: bigint;\n  xR: bigint;\n} {\n  let xL = F.e(_xL_in);\n  let xR = F.e(_xR_in);\n  const k = F.e(_k);\n  for (let i = 0; i < NROUNDS; i += 1) {\n    const c = cts[i];\n    const t = i === 0 ? F.add(xL, k) : F.add(F.add(xL, k), c);\n    const xR_tmp = F.e(xR);\n    if (i < NROUNDS - 1) {\n      xR = xL;\n      xL = F.add(xR_tmp, F.pow(t, 5));\n    } else {\n      xR = F.add(xR_tmp, F.pow(t, 5));\n    }\n  }\n  return {\n    xL: F.normalize(xL),\n    xR: F.normalize(xR),\n  };\n}\n\nexport function mimcMultiHash(arr: any[], key: any, numOutputs: number): bigint[] {\n  let _key = key;\n  let _numOutputs = numOutputs;\n  if (typeof _numOutputs === \"undefined\") {\n    _numOutputs = 1;\n  }\n  if (typeof _key === \"undefined\") {\n    _key = F.zero;\n  }\n\n  let R = F.zero;\n  let C = F.zero;\n\n  for (let i = 0; i < arr.length; i += 1) {\n    R = F.add(R, F.e(arr[i]));\n    const S = mimcHash(R, C, _key);\n    R = S.xL;\n    C = S.xR;\n  }\n  const outputs = [R];\n  for (let i = 1; i < _numOutputs; i += 1) {\n    const S = mimcHash(R, C, _key);\n    R = S.xL;\n    C = S.xR;\n    outputs.push(R);\n  }\n  if (_numOutputs === 1) {\n    return F.normalize(outputs[0]);\n  }\n  return outputs.map((x) => F.normalize(x));\n}\n","import BN from \"bn.js\";\n\nimport { mimcHash } from \"./mimcsponge\";\n\nexport const SECP256K1_CURVE_N = \"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141\";\n\n// creates sub-keys via MiMC hash, output keys are not padded\nexport function subkey(keyHex: string, input: Buffer): string {\n  const privKeyBuf = new BN(keyHex, \"hex\").toString(10);\n  // TODO: check against existing usage of mimc\n  // TODO: check that MPC is possible with mimc, with tests\n  const inputPath = new BN(input).umod(new BN(SECP256K1_CURVE_N, \"hex\")).toString(10);\n\n  const output = mimcHash(1, privKeyBuf, inputPath);\n  return output.xL.toString(16);\n}\n","export * from \"./keyDerivation\";\nexport * from \"./mimcsponge\";\n"],"names":["Scalar","ZqField","keccak256","BN","F","fromString","SEED","NROUNDS","keccak256Padded","str","finalInput","Buffer","from","slice","length","toString","padStart","mimgGetIV","seed","_seed","c","cn","iv","mod","p","mimcGetConstants","nRounds","_nRounds","cts","Array","i","n1","c2","e","mimcHash","_xL_in","_xR_in","_k","xL","xR","k","t","add","xR_tmp","pow","normalize","mimcMultiHash","arr","key","numOutputs","_key","_numOutputs","zero","R","C","S","outputs","push","map","x","SECP256K1_CURVE_N","subkey","keyHex","input","privKeyBuf","inputPath","umod","output"],"sourceRoot":""}