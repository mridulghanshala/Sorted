import { get, patch, post, put } from "@toruslabs/http-helpers";

import { ApiRequestParams, ISessionManager } from "./interfaces";

export abstract class BaseSessionManager<TSessionData> implements ISessionManager<TSessionData> {
  sessionId: string;

  checkSessionParams() {
    if (!this.sessionId) throw new Error("Session id is required");
    this.sessionId = this.sessionId.padStart(64, "0");
  }

  /**
   * Common handler method for making an http request.
   *
   * Note: Embed all the query parameters in the path itself.
   */
  protected request<T>({ method = "GET", url, data = {}, headers = {} }: ApiRequestParams): Promise<T> {
    const options = { headers };

    switch (method) {
      case "GET":
        return get<T>(url, options);
      case "POST":
        return post<T>(url, data, options);
      case "PUT":
        return put<T>(url, data, options);
      case "PATCH":
        return patch<T>(url, data, options);
    }

    throw new Error("Invalid method type");
  }

  abstract createSession(data: TSessionData): Promise<string>;

  abstract authorizeSession(): Promise<TSessionData>;

  abstract updateSession(data: Partial<TSessionData>): Promise<void>;

  abstract invalidateSession(): Promise<boolean>;
}
