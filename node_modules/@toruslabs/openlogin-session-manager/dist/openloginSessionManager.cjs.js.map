{"version":3,"file":"openloginSessionManager.cjs.js","mappings":"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","sources":["webpack://@toruslabs/openlogin-session-manager/webpack/bootstrap","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/compat get default export","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/define property getters","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/hasOwnProperty shorthand","webpack://@toruslabs/openlogin-session-manager/webpack/runtime/make namespace object","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@toruslabs/base-session-manager\"","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@toruslabs/eccrypto\"","webpack://@toruslabs/openlogin-session-manager/external commonjs2 \"@toruslabs/metadata-helpers\"","webpack://@toruslabs/openlogin-session-manager/./src/openloginSessionManager.ts","webpack://@toruslabs/openlogin-session-manager/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/base-session-manager\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/eccrypto\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/metadata-helpers\");","import { BaseSessionManager } from \"@toruslabs/base-session-manager\";\nimport { generatePrivate, getPublic, sign } from \"@toruslabs/eccrypto\";\nimport { decryptData, encryptData, keccak256 } from \"@toruslabs/metadata-helpers\";\n\nimport { OpenloginSessionManagerOptions, SessionApiResponse, SessionRequestBody } from \"./interfaces\";\n\nconst DEFAULT_SESSION_TIMEOUT = 86400;\nexport class OpenloginSessionManager<T> extends BaseSessionManager<T> {\n  sessionServerBaseUrl = \"https://broadcast-server.tor.us\";\n\n  sessionNamespace: string;\n\n  sessionTime: number = DEFAULT_SESSION_TIMEOUT;\n\n  public sessionId: string = \"\";\n\n  constructor({ sessionServerBaseUrl, sessionNamespace, sessionTime, sessionId }: OpenloginSessionManagerOptions = {}) {\n    super();\n\n    if (sessionServerBaseUrl) {\n      this.sessionServerBaseUrl = sessionServerBaseUrl;\n    }\n    if (sessionNamespace) this.sessionNamespace = sessionNamespace;\n    if (sessionTime) this.sessionTime = sessionTime;\n    if (sessionId) this.sessionId = sessionId.padStart(64, \"0\");\n  }\n\n  static generateRandomSessionKey(): string {\n    return generatePrivate().toString(\"hex\").padStart(64, \"0\");\n  }\n\n  async createSession(data: T): Promise<string> {\n    super.checkSessionParams();\n    const privKey = Buffer.from(this.sessionId, \"hex\");\n    const pubKey = getPublic(privKey).toString(\"hex\");\n    const encData = await encryptData(this.sessionId, data);\n    const signature = (await sign(privKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\");\n\n    const body: SessionRequestBody = {\n      key: pubKey,\n      data: encData,\n      signature,\n      namespace: this.sessionNamespace,\n      timeout: this.sessionTime,\n    };\n\n    await super.request({ method: \"POST\", url: `${this.sessionServerBaseUrl}/store/set`, data: body });\n\n    return this.sessionId;\n  }\n\n  async authorizeSession(): Promise<T> {\n    super.checkSessionParams();\n    const pubkey = getPublic(Buffer.from(this.sessionId, \"hex\")).toString(\"hex\");\n    const url = new URL(`${this.sessionServerBaseUrl}/store/get`);\n    url.searchParams.append(\"key\", pubkey);\n    if (this.sessionNamespace) url.searchParams.append(\"namespace\", this.sessionNamespace);\n\n    const result = await super.request<SessionApiResponse>({ url: url.toString() });\n    if (!result.message) {\n      throw new Error(\"Session Expired or Invalid public key\");\n    }\n\n    const response = await decryptData<T & { error?: string }>(this.sessionId, result.message);\n    if (response.error) {\n      throw new Error(\"There was an error decrypting data.\");\n    }\n\n    return response;\n  }\n\n  async updateSession(data: Partial<T>): Promise<void> {\n    super.checkSessionParams();\n    const privKey = Buffer.from(this.sessionId, \"hex\");\n    const pubKey = getPublic(privKey).toString(\"hex\");\n    const encData = await encryptData(this.sessionId, data);\n    const signature = (await sign(privKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\");\n\n    const body: SessionRequestBody = {\n      key: pubKey,\n      data: encData,\n      signature,\n      namespace: this.sessionNamespace,\n    };\n\n    await super.request({ method: \"PUT\", url: `${this.sessionServerBaseUrl}/store/update`, data: body });\n  }\n\n  async invalidateSession(): Promise<boolean> {\n    super.checkSessionParams();\n    const privKey = Buffer.from(this.sessionId, \"hex\");\n    const pubKey = getPublic(privKey).toString(\"hex\");\n    const encData = await encryptData(this.sessionId, {});\n    const signature = (await sign(privKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\");\n\n    const data: SessionRequestBody = {\n      key: pubKey,\n      data: encData,\n      signature,\n      namespace: this.sessionNamespace,\n      timeout: 1,\n    };\n\n    await super.request({ method: \"POST\", url: `${this.sessionServerBaseUrl}/store/set`, data });\n    this.sessionId = \"\";\n    return true;\n  }\n}\n","export * from \"./interfaces\";\nexport * from \"./openloginSessionManager\";\n"],"names":["BaseSessionManager","generatePrivate","getPublic","sign","decryptData","encryptData","keccak256","DEFAULT_SESSION_TIMEOUT","OpenloginSessionManager","constructor","sessionServerBaseUrl","sessionNamespace","sessionTime","sessionId","arguments","length","undefined","_defineProperty","padStart","generateRandomSessionKey","toString","createSession","data","checkSessionParams","privKey","Buffer","from","pubKey","encData","signature","body","key","namespace","timeout","request","method","url","authorizeSession","pubkey","URL","searchParams","append","result","message","Error","response","error","updateSession","invalidateSession"],"sourceRoot":""}